<div class="container">
  <div class="row">
    <div class="col-10 mx-auto">
      <div class="container py-5">
        <div class="row pb-2 align-items-center">
          <div class="col">
            <h2>Carga Derivados Manual</h2>
          </div>
        </div>

        <!-- Zona Drag & Drop -->
        <div *ngIf="newFichaDerivado.relaciones.length === 0; else dataPreview"
             class="drag-drop-area"
             (drop)="onDrop($event)"
             (dragover)="onDragOver($event)"
             (dragleave)="onDragLeave($event)">
          <div class="file-upload pt-4 text-center">
            <input type="file"
                   (change)="onFileSelected($event)"
                   accept=".xlsx"
                   hidden
                   #fileInput>
            <p>Por favor, selecciona un archivo Excel válido (.xlsx) de hasta 10MB.</p>
            <app-request-button (click)="fileInput.click()"
                                [isLoading]="isLoadingFile"
                                [disabled]="disabled"
                                icon="upload-cloud">
              Seleccionar archivo
            </app-request-button>
            <div>
              <small>Arrastra tu archivo aquí</small>
            </div>
          </div>
        </div>

        <!-- Preview de datos extraídos -->
        <ng-template #dataPreview>
          <div class="my-4">
            <h5>Datos cargados desde Excel:</h5>
            <p><strong>Fecha de carga:</strong> {{ newFichaDerivado.fechaCarga }}</p>

            <div class="table-responsive">
              <table class="table table-bordered table-sm">
                <thead class="table-light">
                  <tr>
                    <th>Tipo Identificación</th>
                    <th>Exposición</th>
                    <th>Fecha Operación</th>
                    <th>Fecha Carga</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of newFichaDerivado.relaciones">
                    <td>{{ item.tipoIdentificacion }}</td>
                    <td>{{ item.exposicion }}</td>
                    <td>{{ item.fechaOperacion }}</td>
                    <td>{{ item.fechaCarga }}</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Botones de acción -->
            <div class="d-flex gap-3 mt-3">
              <button type="button"
                      class="btn btn-outline-danger"
                      (click)="reset()">
                Cancelar cambios
              </button>

              <app-request-button (click)="storeNewFactSheet()"
                                  [isLoading]="storeNewFactSheetIsLoading"
                                  [disabled]="storeNewFactSheetDisabled"
                                  icon="upload-cloud">
                Guardar Derivados
              </app-request-button>
            </div>
          </div>
        </ng-template>

      </div>
    </div>
  </div>
</div>
